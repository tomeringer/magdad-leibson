// הגדרת הנגד הקבוע (למשל 10k או 47k - בדוק מה שמת במעגל)
float R_DIVIDER = 47000.0; 
float V_IN = 5.0; // מתח הארדואינו

// פינים
int pins[] = {A0, A1, A3, A5};
// מערך לשמירת התנגדויות
float resistances[4];
// מערך לפלטים (דיגיטליים)
byte packed_output;

// ספים לזיהוי כיפוף (כוונן את הערכים האלה לפי הניסוי שלך)
float thresholds[] = {40000.0, 40000.0, 60000.0, 180000.0}; 

byte START = 0xAA;
byte END = 0x55;

void setup() {
  Serial.begin(115200); 
}

void loop() {
  packed_output=0;
  for (int i = 0; i < 4; i++) {
    int adcVal = analogRead(pins[i]);
    
    // הגנה מפני חלוקה באפס
    if (adcVal == 0) adcVal = 1; 

    // המרת ערך אנלוגי למתח (0-5V)
    float voltage = adcVal * (V_IN / 1023.0);
    
    // חישוב ההתנגדות של החיישן (לפי נוסחת מחלק מתח רגילה)
    // R_flex = R_fixed * (V_out / (V_in - V_out))
    // ההנחה: החיישן מחובר בין הפין ל-GND, והנגד הקבוע בין הפין ל-5V
    resistances[i] = R_DIVIDER * (voltage / (V_IN - voltage));

    // קביעת הסטטוס (0 או 1)
    if (resistances[i] > thresholds[i]) {
      packed_output |= (1 << i);
    }
  }

  // הדפסה לבדיקה
  // Serial.print("R1: "); Serial.print((int)resistances[0]);
  // Serial.print(" | R2: "); Serial.print((int)resistances[1]);
  // Serial.print(" | R3: "); Serial.print((int)resistances[2]);
  // Serial.print(" | R4: "); Serial.println((int)resistances[3]);

  // שליחה מהירה (למשל לפייתון)
  Serial.write(START);
  Serial.write(packed_output);
  Serial.write(END);

  delay(500); 
}